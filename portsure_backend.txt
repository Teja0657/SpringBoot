main/java/com.portsure.backend
===============================
 controller
 ===========
1. AuthController
=================
package com.portsure.backend.controller;

import com.portsure.backend.dto.ChangePasswordRequest;
import com.portsure.backend.dto.ForgotPasswordRequest;
import com.portsure.backend.dto.LoginRequest;
import com.portsure.backend.dto.RegisterRequest;
import com.portsure.backend.service.AuthService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

@RestController
@RequestMapping("/auth")
@CrossOrigin(origins = "http://localhost:3000") // Allows React to connect
public class AuthController {

    @Autowired
    private AuthService authService;

    @PostMapping("/register")
    public ResponseEntity<?> registerUser(@RequestBody RegisterRequest request) {
        try {
            Object user = authService.register(request);
            return ResponseEntity.ok(user);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    @PostMapping("/login")
    public ResponseEntity<?> loginUser(@RequestBody LoginRequest request) {
        try {
            Object user = authService.login(request);
            return ResponseEntity.ok(user);
        } catch (RuntimeException e) {
            return ResponseEntity.status(401).body(e.getMessage());
        }
    }
    // Endpoint 1: Forgot Password (POST because user is not logged in)
    @PostMapping("/forgot-password")
    public ResponseEntity<?> forgotPassword(@RequestBody ForgotPasswordRequest request) {
        try {
            authService.resetPassword(request);
            return ResponseEntity.ok("Password reset successfully. Please login.");
        } catch (RuntimeException e) {
            return ResponseEntity.status(404).body(e.getMessage());
        }
    }

    // Endpoint 2: Change Password (PUT because we are updating existing data)
    @PutMapping("/change-password")
    public ResponseEntity<?> changePassword(@RequestBody ChangePasswordRequest request) {
        try {
            authService.changePassword(request);
            return ResponseEntity.ok("Password updated successfully!");
        } catch (RuntimeException e) {
            return ResponseEntity.status(400).body(e.getMessage());
        }
    }
}

2.InvestorController
====================
package com.portsure.backend.controller;

import com.portsure.backend.model.Investor;
import com.portsure.backend.service.PortfolioService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.List;

@RestController
@RequestMapping("/investors")
@CrossOrigin(origins = "http://localhost:3000")
public class InvestorController {

    @Autowired
    private PortfolioService portfolioService; // Reusing service for simplicity

    // URL: http://localhost:8080/investors/all
    @GetMapping("/all")
    public List<Investor> getAllInvestors() {
        return portfolioService.getAllInvestors();
    }
}

3.PortfolioConroller
===================
package com.portsure.backend.controller;

import com.portsure.backend.model.Portfolio;
import com.portsure.backend.service.PortfolioService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/portfolios")
@CrossOrigin(origins = "http://localhost:3000")
public class PortfolioController {

    @Autowired
    private PortfolioService portfolioService;

    // 1. Create Portfolio (Investor)
    // URL: http://localhost:8080/portfolios/add?investorId=INV-123
    @PostMapping("/add")
    public ResponseEntity<?> createPortfolio(@RequestParam String investorId, @RequestBody Portfolio portfolio) {
        try {
            Portfolio created = portfolioService.createPortfolio(investorId, portfolio);
            return ResponseEntity.ok(created);
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // 2. Get My Portfolios (Investor)
    // URL: http://localhost:8080/portfolios/get?investorId=INV-123
    @GetMapping("/get")
    public List<Portfolio> getMyPortfolios(@RequestParam String investorId) {
        return portfolioService.getMyPortfolios(investorId);
    }

    // 3. Approve Portfolio (Manager)
    // URL: http://localhost:8080/portfolios/approve/PF-123
    @PutMapping("/approve/{portfolioId}")
    public ResponseEntity<?> approvePortfolio(@PathVariable String portfolioId) {
        try {
            return ResponseEntity.ok(portfolioService.approvePortfolio(portfolioId));
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }

    // 4. Reject Portfolio (Manager)
    // URL: http://localhost:8080/portfolios/reject/PF-123
    @DeleteMapping("/reject/{portfolioId}")
    public ResponseEntity<?> rejectPortfolio(@PathVariable String portfolioId) {
        try {
            portfolioService.rejectPortfolio(portfolioId);
            return ResponseEntity.ok("Portfolio Rejected and Deleted");
        } catch (RuntimeException e) {
            return ResponseEntity.badRequest().body(e.getMessage());
        }
    }
}


dto
===
1.ChangePasswordRequest
=======================
package com.portsure.backend.dto;

public class ChangePasswordRequest {
    private String email;
    private String oldPassword;
    private String newPassword;

    // Getters
    public String getEmail() { return email; }
    public String getOldPassword() { return oldPassword; }
    public String getNewPassword() { return newPassword; }

    // Setters
    public void setEmail(String email) { this.email = email; }
    public void setOldPassword(String oldPassword) { this.oldPassword = oldPassword; }
    public void setNewPassword(String newPassword) { this.newPassword = newPassword; }
}

2.ForgotPasswordRequest
=======================
package com.portsure.backend.dto;

public class ForgotPasswordRequest {
    private String email;
    private String newPassword;

    // Getters and Setters
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public String getNewPassword() { return newPassword; }
    public void setNewPassword(String newPassword) { this.newPassword = newPassword; }
}

3. LoginRequest
===============
package com.portsure.backend.dto;

public class LoginRequest {
    private String emailOrId;
    private String password;
    private String role;

    public LoginRequest() {}

    // --- MANUALLY ADDED GETTERS AND SETTERS ---
    public String getEmailOrId() { return emailOrId; }
    public void setEmailOrId(String emailOrId) { this.emailOrId = emailOrId; }

    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }

    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }
}

4. RegisterRequest
==================
package com.portsure.backend.dto;

public class RegisterRequest {
    private String name;
    private String email;
    private String password;
    private String mobile;
    private String role;
    private String staffKey;

    public RegisterRequest() {}

    // --- MANUALLY ADDED GETTERS AND SETTERS ---
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }

    public String getMobile() { return mobile; }
    public void setMobile(String mobile) { this.mobile = mobile; }

    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }

    public String getStaffKey() { return staffKey; }
    public void setStaffKey(String staffKey) { this.staffKey = staffKey; }
}

Model
=====
1.Investor
==========
package com.portsure.backend.model;

import jakarta.persistence.*;

@Entity
@Table(name = "investors")
public class Investor {

    @Id
    private String id;

    @Column(nullable = false)
    private String name;

    @Column(nullable = false, unique = true)
    private String email;

    @Column(nullable = false)
    private String password;

    private String mobile;

    @Column(name = "total_balance")
    private Double totalBalance;

    private String role = "INVESTOR";

    public Investor() {}

    public Investor(String id, String name, String email, String password, String mobile, Double totalBalance) {
        this.id = id;
        this.name = name;
        this.email = email;
        this.password = password;
        this.mobile = mobile;
        this.totalBalance = totalBalance;
    }

    // --- MANUALLY ADDED GETTERS AND SETTERS ---
    public String getId() { return id; }
    public void setId(String id) { this.id = id; }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }

    public String getMobile() { return mobile; }
    public void setMobile(String mobile) { this.mobile = mobile; }

    public Double getTotalBalance() { return totalBalance; }
    public void setTotalBalance(Double totalBalance) { this.totalBalance = totalBalance; }

    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }
}

2.Portfolio
==========
package com.portsure.backend.model;

import jakarta.persistence.*;
import com.fasterxml.jackson.annotation.JsonIgnore;

@Entity
@Table(name = "portfolios")
public class Portfolio {

    @Id
    @Column(name = "portfolio_id")
    private String portfolioId;

    @Column(nullable = false)
    private String name;

    @Column(name = "investment_amount", nullable = false)
    private Double investmentAmount;

    private String status;

    @Column(name = "created_date")
    private String date;

    @Column(name = "equity_percent")
    private int equityPercent;

    @Column(name = "bond_percent")
    private int bondPercent;

    @Column(name = "derivative_percent")
    private int derivativePercent;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "investor_id", nullable = false)
    @JsonIgnore
    private Investor investor;

    public Portfolio() {}

    // --- MANUALLY ADDED GETTERS AND SETTERS ---
    public String getPortfolioId() { return portfolioId; }
    public void setPortfolioId(String portfolioId) { this.portfolioId = portfolioId; }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public Double getInvestmentAmount() { return investmentAmount; }
    public void setInvestmentAmount(Double investmentAmount) { this.investmentAmount = investmentAmount; }

    public String getStatus() { return status; }
    public void setStatus(String status) { this.status = status; }

    public String getDate() { return date; }
    public void setDate(String date) { this.date = date; }

    public int getEquityPercent() { return equityPercent; }
    public void setEquityPercent(int equityPercent) { this.equityPercent = equityPercent; }

    public int getBondPercent() { return bondPercent; }
    public void setBondPercent(int bondPercent) { this.bondPercent = bondPercent; }

    public int getDerivativePercent() { return derivativePercent; }
    public void setDerivativePercent(int derivativePercent) { this.derivativePercent = derivativePercent; }

    public Investor getInvestor() { return investor; }
    public void setInvestor(Investor investor) { this.investor = investor; }
}
3.Staff
=======
package com.portsure.backend.model;

import jakarta.persistence.*;

@Entity
@Table(name = "staff")
public class Staff {

    @Id
    private String id;

    @Column(nullable = false)
    private String name;

    @Column(nullable = false, unique = true)
    private String email;

    @Column(nullable = false)
    private String password;

    private String mobile;

    @Column(nullable = false)
    private String role;

    @Column(name = "security_key", nullable = false)
    private String securityKey;

    public Staff() {}

    // --- MANUALLY ADDED GETTERS AND SETTERS ---
    public String getId() { return id; }
    public void setId(String id) { this.id = id; }

    public String getName() { return name; }
    public void setName(String name) { this.name = name; }

    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }

    public String getPassword() { return password; }
    public void setPassword(String password) { this.password = password; }

    public String getMobile() { return mobile; }
    public void setMobile(String mobile) { this.mobile = mobile; }

    public String getRole() { return role; }
    public void setRole(String role) { this.role = role; }

    public String getSecurityKey() { return securityKey; }
    public void setSecurityKey(String securityKey) { this.securityKey = securityKey; }
}

repository
==========
1.InvestorRepository
====================
package com.portsure.backend.repository;

import com.portsure.backend.model.Investor;
import org.springframework.data.jpa.repository.JpaRepository;
import java.util.Optional;

public interface InvestorRepository extends JpaRepository<Investor, String> {
    // Custom method to find a user by email (used for Login)
    Optional<Investor> findByEmail(String email);

    // Checks if an email already exists (used for Registration)
    boolean existsByEmail(String email);
}
2.PortfolioRepository
=====================
package com.portsure.backend.repository;

import com.portsure.backend.model.Portfolio;
import org.springframework.data.jpa.repository.JpaRepository;
import java.util.List;

public interface PortfolioRepository extends JpaRepository<Portfolio, String> {
    // Fetches all portfolios for a specific investor ID
    List<Portfolio> findByInvestor_Id(String investorId);
}
3.StaffRepository
=================
package com.portsure.backend.repository;

import com.portsure.backend.model.Staff;
import org.springframework.data.jpa.repository.JpaRepository;
import java.util.Optional;

public interface StaffRepository extends JpaRepository<Staff, String> {
    Optional<Staff> findByEmail(String email);
}

service
========
1.AuthService
=============
package com.portsure.backend.service;

import com.portsure.backend.dto.ChangePasswordRequest;
import com.portsure.backend.dto.ForgotPasswordRequest;
import com.portsure.backend.dto.LoginRequest;
import com.portsure.backend.dto.RegisterRequest;
import com.portsure.backend.model.Investor;
import com.portsure.backend.model.Staff;
import com.portsure.backend.repository.InvestorRepository;
import com.portsure.backend.repository.StaffRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.Optional;

@Service
public class AuthService {

    @Autowired
    private InvestorRepository investorRepo;

    @Autowired
    private StaffRepository staffRepo;

    private static final String STAFF_SECRET = "PORTSURE";

    // --- REGISTER LOGIC ---
    public Object register(RegisterRequest req) {
        if (req.getRole().equals("INVESTOR")) {
            if (investorRepo.existsByEmail(req.getEmail())) {
                throw new RuntimeException("Email already exists");
            }
            Investor inv = new Investor();
            inv.setId("INV-" + System.currentTimeMillis()); // Generates INV-1724...
            inv.setName(req.getName());
            inv.setEmail(req.getEmail());
            inv.setPassword(req.getPassword());
            inv.setMobile(req.getMobile());
            inv.setTotalBalance(100000.0); // Default Balance

            return investorRepo.save(inv);

        } else {
            // Staff Registration (Manager/Compliance)
            if (!STAFF_SECRET.equals(req.getStaffKey())) {
                throw new RuntimeException("Invalid Staff Security Key!");
            }
            Staff staff = new Staff();
            String prefix = req.getRole().equals("MANAGER") ? "MGR-" : "CMP-";
            staff.setId(prefix + System.currentTimeMillis());
            staff.setName(req.getName());
            staff.setEmail(req.getEmail());
            staff.setPassword(req.getPassword());
            staff.setMobile(req.getMobile());
            staff.setRole(req.getRole());
            staff.setSecurityKey(req.getStaffKey());

            return staffRepo.save(staff);
        }
    }

    // --- LOGIN LOGIC ---
    public Object login(LoginRequest req) {
        if ("INVESTOR".equals(req.getRole())) {
            // 1. Try finding by Email
            Optional<Investor> inv = investorRepo.findByEmail(req.getEmailOrId());
            // 2. If not found by email, try finding by ID (User can login with either)
            if (inv.isEmpty()) {
                inv = investorRepo.findById(req.getEmailOrId());
            }

            if (inv.isPresent() && inv.get().getPassword().equals(req.getPassword())) {
                return inv.get();
            }
        } else {
            // Check Staff Table
            Optional<Staff> staff = staffRepo.findByEmail(req.getEmailOrId());
            if (staff.isEmpty()) {
                staff = staffRepo.findById(req.getEmailOrId());
            }

            if (staff.isPresent() && staff.get().getPassword().equals(req.getPassword())
                    && staff.get().getRole().equals(req.getRole())) {
                return staff.get();
            }
        }
        throw new RuntimeException("Invalid Credentials");
    }
    // --- 1. LOGIC FOR FORGOT PASSWORD (No old password needed) ---
    public void resetPassword(ForgotPasswordRequest request) {
        // Check Investor Table
        var investor = investorRepo.findByEmail(request.getEmail());
        if (investor.isPresent()) {
            Investor inv = investor.get();
            inv.setPassword(request.getNewPassword()); // In real life: passwordEncoder.encode(...)
            investorRepo.save(inv);
            return;
        }

        // Check Staff Table
        var staff = staffRepo.findByEmail(request.getEmail());
        if (staff.isPresent()) {
            Staff st = staff.get();
            st.setPassword(request.getNewPassword());
            staffRepo.save(st);
            return;
        }

        throw new RuntimeException("Email not found in our records.");
    }

    // --- 2. LOGIC FOR CHANGE PASSWORD (Requires old password) ---
    public void changePassword(ChangePasswordRequest request) {
        // Check Investor Table
        var investor = investorRepo.findByEmail(request.getEmail());
        if (investor.isPresent()) {
            Investor inv = investor.get();
            if (!inv.getPassword().equals(request.getOldPassword())) {
                throw new RuntimeException("Incorrect old password!");
            }
            inv.setPassword(request.getNewPassword());
            investorRepo.save(inv);
            return;
        }

        // Check Staff Table
        var staff = staffRepo.findByEmail(request.getEmail());
        if (staff.isPresent()) {
            Staff st = staff.get();
            if (!st.getPassword().equals(request.getOldPassword())) {
                throw new RuntimeException("Incorrect old password!");
            }
            st.setPassword(request.getNewPassword());
            staffRepo.save(st);
            return;
        }

        throw new RuntimeException("User not found.");
    }
}
2.PortfolioService
==================
package com.portsure.backend.service;

import com.portsure.backend.model.Investor;
import com.portsure.backend.model.Portfolio;
import com.portsure.backend.repository.InvestorRepository;
import com.portsure.backend.repository.PortfolioRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
public class PortfolioService {

    @Autowired
    private PortfolioRepository portfolioRepo;

    @Autowired
    private InvestorRepository investorRepo;

    // Create a new Portfolio
    public Portfolio createPortfolio(String investorId, Portfolio inputPortfolio) {
        // 1. Check Allocation Logic (Must be 100%)
        // FIXED: Renamed variable to remove space (valid Java syntax)
        int totalPrecise = inputPortfolio.getEquityPercent() + inputPortfolio.getBondPercent() + inputPortfolio.getDerivativePercent();

        if (totalPrecise != 100) {
            throw new RuntimeException("Total allocation must be exactly 100%. Current: " + totalPrecise + "%");
        }

        // 2. Fetch Investor to check balance
        Investor investor = investorRepo.findById(investorId)
                .orElseThrow(() -> new RuntimeException("Investor not found"));

        // 3. Calculate currently used balance
        List<Portfolio> existingPortfolios = portfolioRepo.findByInvestor_Id(investorId);
        double usedAmount = existingPortfolios.stream()
                .mapToDouble(Portfolio::getInvestmentAmount)
                .sum();

        // 4. Check if they have enough money
        if (usedAmount + inputPortfolio.getInvestmentAmount() > investor.getTotalBalance()) {
            throw new RuntimeException("Insufficient Balance! Limit: " + investor.getTotalBalance());
        }

        // 5. Save Logic
        inputPortfolio.setPortfolioId("PF-" + System.currentTimeMillis());
        inputPortfolio.setStatus("PENDING");
        inputPortfolio.setInvestor(investor); // Link to the user

        return portfolioRepo.save(inputPortfolio);
    }

    // Get all portfolios for an investor
    public List<Portfolio> getMyPortfolios(String investorId) {
        return portfolioRepo.findByInvestor_Id(investorId);
    }

    // --- MANAGER ACTIONS ---

    public Portfolio approvePortfolio(String portfolioId) {
        Portfolio p = portfolioRepo.findById(portfolioId)
                .orElseThrow(() -> new RuntimeException("Portfolio not found"));

        p.setStatus("APPROVED");
        return portfolioRepo.save(p);
    }

    public void rejectPortfolio(String portfolioId) {
        if(portfolioRepo.existsById(portfolioId)) {
            portfolioRepo.deleteById(portfolioId);
        } else {
            throw new RuntimeException("Portfolio not found");
        }
    }

    // For Directory View (Managers need to see everyone)
    public List<Investor> getAllInvestors() {
        return investorRepo.findAll();
    }
}

application.properties
=====================
# --- Server Configuration ---
# Runs the backend on port 8080 (React is on 3000)
server.port=8081

# --- Database Connection ---
# If 'portsure_db' does not exist, this URL will create it automatically
spring.datasource.url=jdbc:mysql://localhost:3306/portsure_db?createDatabaseIfNotExist=true&useSSL=false&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=Whmd@2003
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# --- JPA / Hibernate (The Magic) ---
# 'update': Keeps your data when you restart.
# Use 'create' if you want to wipe the database every time you restart.
spring.jpa.hibernate.ddl-auto=update

# Shows the SQL commands in the console (Great for debugging)
spring.jpa.show-sql=true

# Tells Hibernate we are using MySQL 8
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

pom.xml
=======
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>

    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>3.2.1</version> <relativePath/>
    </parent>

    <groupId>com.portsure</groupId>
    <artifactId>backend</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>PortSure_backend</name>
    <description>Backend for PortSure Portfolio System</description>

    <properties>
        <java.version>17</java.version> </properties>

    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>

        <dependency>
            <groupId>com.mysql</groupId>
            <artifactId>mysql-connector-j</artifactId>
            <scope>runtime</scope>
        </dependency>


        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
            <scope>runtime</scope>
            <optional>true</optional>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springdoc</groupId>
            <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
            <version>2.3.0</version>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>

                </configuration>
            </plugin>
        </plugins>
    </build>

</project>